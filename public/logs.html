<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Logs de Serviços - ANFeGuard</title>
    <link rel="shortcut icon" href="icon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="./styles/logs.css" />
    <script src="https://unpkg.com/htmx.org@2.0.0"></script>
  </head>
  <body>
    <div class="sidebar">
      <h2 class="logo">ANFeGuard</h2>
      <nav>
        <a href="/index.html">Dashboard</a>
        <a href="/servico.html">Serviços</a>
        <a href="/cadastro.html">Controle de Portas</a>
        <a href="/logs.html" class="active">Logs</a>
      </nav>
    </div>

    <div class="main-content">
      <header>
        <h1>Logs de Serviços</h1>
      </header>

      <table class="logs-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Serviço</th>
            <th>Status</th>
            <th>Mensagem</th>
            <th>Memória (%)</th>
            <th>Data/Hora</th>
          </tr>
        </thead>
        <tbody
          id="logs-body"
          hx-get="/api/logs"
          hx-trigger="load, every 60s"
          hx-swap="innerHTML"
        >
          <tr>
            <td colspan="6" class="empty">Carregando logs...</td>
          </tr>
        </tbody>
      </table>
    </div>

    <script>
      document.body.addEventListener("htmx:afterRequest", (evt) => {
        if (evt.detail.pathInfo.requestPath === "/api/logs") {
          const xhr = evt.detail.xhr;
          try {
            const data = JSON.parse(xhr.responseText);
            const container = document.getElementById("logs-body");
            container.innerHTML = data
              .map(
                (log) => `
            <tr>
              <td>${log.id}</td>
              <td>${log.service_name}</td>
              <td>${log.status}</td>
              <td>${log.message || ""}</td>
              <td>${log.memory_percent || ""}</td>
              <td>${log.created_at}</td>
            </tr>
          `
              )
              .join("");
          } catch (err) {
            console.error("Erro ao processar JSON:", err);
          }
        }
      });
    </script>
  </body>
</html>
